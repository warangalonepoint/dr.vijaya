<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fetal Diagnosis & Therapy</title>
<link rel="stylesheet" href="styles/styles.css">
<script defer src="scripts/utils.js"></script>
<script defer src="scripts/db.js"></script>
<script defer src="scripts/models.js"></script>
</head>
<body><body class="bg-teal">

<header class="topbar">
  <div class="brand-inline"><img src="assets/logo.png" class="logo-sm"><strong>Diagnosis & Therapy</strong></div>
  <div class="topbar-actions">
    <span id="roleBadge" class="badge"></span>
    <button id="themeToggle" class="btn ghost">ðŸŒ“</button>
    <a class="btn ghost" href="dashboard.html">Home</a>
  </div>
</header>
<section class="card">
  <h3>Procedures</h3>
  <div id="procEmpty" class="empty">
    <img src="assets/illus/empty-state.svg" alt="No procedure illustration" width="200">
    <p>No procedures have been logged yet.</p>
  </div>
</section>

<main class="card">
  <h3>Procedure Entry</h3>
  <div class="grid two">
    <label>Pregnancy ID<input id="pregId" class="input"></label>
    <label>Kind<select id="kind" class="input"><option>CVS</option><option>Amniocentesis</option><option>Fetal Reduction</option><option>Intrauterine Transfusion</option></select></label>
    <label>Consent PDF (data URL)<textarea id="consent" class="input" rows="2" placeholder="data:application/pdf;base64,..."></textarea></label>
    <label>Pre-op checklist<textarea id="preop" class="input" rows="2"></textarea></label>
    <label>Lot numbers<textarea id="lots" class="input" rows="2"></textarea></label>
    <label>Post-op complications<textarea id="comp" class="input" rows="2"></textarea></label>
    <label>Follow-up Date<input id="fup" class="input" type="date"></label>
  </div>
  <button class="btn primary" onclick="saveProc()">Save procedure</button>
  <h3 class="mt-2">Registry</h3><div id="list" class="list"></div>
</main>
<footer class="footer"><span>Track consent, lots, follow-up.</span><span class="version">v0.2.0</span></footer>
<script>
guardSessionOrRedirect(); setupThemeToggle(); showRoleBadge();
window.addEventListener('DOMContentLoaded', async ()=>{ await window.DB.ensureReady(); render(); });
async function saveProc(){ const data={pregnancyId: pregId.value.trim(), kind: kind.value, consentPdf: consent.value.trim(), preopChecklist: preop.value.trim(), lotNumbers: lots.value.trim(), complications: comp.value.trim(), followupDate: fup.value}; await window.Models.addProcedure(data); toast('Saved'); render(); }
async function render(){ const list=await window.Models.listProcedures(); const el=document.getElementById('list'); el.innerHTML=''; list.forEach(p=>{ const d=document.createElement('div'); d.className='row'; d.innerHTML = `<div><strong>${p.kind}</strong> â€¢ Preg ${p.pregnancyId} â€¢ F/U ${p.followupDate||'-'}</div>`; el.appendChild(d); }); }
</script>
<footer class="fixed-footer">
  Powered by Onestop AI Services. All rights reserved.
</footer>
</body></html>